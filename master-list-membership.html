<!DOCTYPE html>
<html lang="en">
<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>Master List - Memberships</title>
		<link rel="stylesheet" href="/frontend/css/style.css">
	</head>
	<body>
		<div class="chart-nav">
				<button onclick="window.location.href='index.html'" class="chart-btn">
						<i>ğŸ“Š</i> Chart
				</button>
		</div>
    
		<div class="dashboard-container">
				<div class="sidebar">
						<div class="sidebar-header">
								<h3>ğŸ“š Library MS</h3>
								<p>Admin Maintenance</p>
						</div>
						<div class="user-info" id="userInfo">
								<!-- User info will be populated here -->
						</div>
						<nav class="sidebar-nav">
								<a href="admin-home.html">
										<span>ğŸ </span> Home
								</a>
								<a href="maintenance.html" class="active">
										<span>ğŸ”§</span> Maintenance
								</a>
								<a href="reports.html">
										<span>ğŸ“Š</span> Reports
								</a>
								<a href="transactions.html">
										<span>ğŸ“‹</span> Transactions
								</a>
								<a href="#" id="logoutBtn">
										<span>ğŸšª</span> Logout
								</a>
						</nav>
				</div>
        
				<div class="main-content">
						<div class="header">
								<h1>Master List - Memberships</h1>
								<div class="header-right">
										<span id="currentDateTime"></span>
										<button onclick="window.location.href='maintenance.html'" class="btn btn-secondary" style="margin-left: 15px;">
												Back to Maintenance
										</button>
								</div>
						</div>

						<div class="card">
								<div class="card-header">
										<h2>Memberships</h2>
										<div>
												<button id="addBtn" class="btn btn-primary">Add Membership</button>
										</div>
								</div>
								<div class="card-body">
										<div class="search-section">
												<div class="search-box">
														<input id="searchInput" type="text" placeholder="Search by Name or Membership No">
														<button id="searchBtn" class="btn btn-primary">Search</button>
														<button id="resetBtn" class="btn btn-secondary">Reset</button>
												</div>
										</div>

										<table class="table" id="members-table">
												<thead>
														<tr>
																<th>Membership No</th>
																<th>Name</th>
																<th>Type</th>
																<th>Start Date</th>
																<th>End Date</th>
																<th>Active</th>
														</tr>
												</thead>
												<tbody>
														<tr>
																<td>MB-0001</td>
																<td>Alice Johnson</td>
																<td>6 months</td>
																<td>2025-08-01</td>
																<td>2026-02-01</td>
																<td>Yes</td>
														</tr>
														<tr>
																<td>MB-0002</td>
																<td>Bob Kumar</td>
																<td>1 year</td>
																<td>2025-01-15</td>
																<td>2026-01-15</td>
																<td>No</td>
														</tr>
												</tbody>
										</table>
								</div>
						</div>

						<div class="card" id="add-card" style="display:none;">
								<div class="card-header"><h2>Add Membership</h2></div>
								<div class="card-body">
										<form id="add-form">
												<div class="form-group">
														<label for="mname">Name *</label>
														<input id="mname" type="text" required>
												</div>

												<div class="form-group">
														<label>Duration *</label>
														<div class="radio-group">
																<label class="radio-label"><input type="radio" name="duration" value="6 months" checked> 6 months</label>
																<label class="radio-label"><input type="radio" name="duration" value="1 year"> 1 year</label>
																<label class="radio-label"><input type="radio" name="duration" value="2 years"> 2 years</label>
														</div>
												</div>

												<div id="add-error" class="error-message" style="display:none;" aria-live="polite"></div>

												<div class="form-actions">
														<button type="submit" class="btn btn-primary">Confirm</button>
														<button type="button" id="cancelAdd" class="btn btn-secondary">Cancel</button>
												</div>
										</form>
								</div>
						</div>
				</div>
		</div>

		<script src="/frontend/js/auth.js"></script>
		<script>
				// Small client-side behavior to match app style
				const searchInput = document.getElementById('searchInput');
				const membersTable = document.getElementById('members-table').tBodies[0];
				const addBtn = document.getElementById('addBtn');
				const addCard = document.getElementById('add-card');
				const addForm = document.getElementById('add-form');
				const addError = document.getElementById('add-error');
				const cancelAdd = document.getElementById('cancelAdd');

				document.getElementById('searchBtn').addEventListener('click', ()=>{
						const q = searchInput.value.trim().toLowerCase();
						Array.from(membersTable.rows).forEach(row=>{
								const text = row.textContent.toLowerCase();
								row.style.display = text.includes(q) ? '' : 'none';
						});
				});
				document.getElementById('resetBtn').addEventListener('click', ()=>{
						searchInput.value = '';
						Array.from(membersTable.rows).forEach(r=> r.style.display='');
				});

				addBtn.addEventListener('click', ()=>{ addCard.style.display = ''; addError.style.display='none'; });
				cancelAdd.addEventListener('click', ()=>{ addCard.style.display = 'none'; addForm.reset(); });

				addForm.addEventListener('submit', e=>{
						e.preventDefault();
						addError.style.display='none';
						const name = document.getElementById('mname').value.trim();
						const duration = addForm.duration.value;
						if(!name){ addError.textContent = 'Name is required.'; addError.style.display='block'; return; }

						const last = Array.from(membersTable.rows).pop();
						let lastNo = 0;
						if(last){ const m = last.cells[0].textContent.match(/MB-(\d+)/); if(m) lastNo = parseInt(m[1],10); }
						const newNo = 'MB-' + String(lastNo + 1).padStart(4,'0');

						const start = new Date();
						const end = new Date(start);
						if(duration === '6 months') end.setMonth(end.getMonth() + 6);
						else if(duration === '1 year') end.setFullYear(end.getFullYear() + 1);
						else if(duration === '2 years') end.setFullYear(end.getFullYear() + 2);

						const toYMD = d => d.toISOString().slice(0,10);

						const row = membersTable.insertRow();
						row.insertCell(0).textContent = newNo;
						row.insertCell(1).textContent = name;
						row.insertCell(2).textContent = duration;
						row.insertCell(3).textContent = toYMD(start);
						row.insertCell(4).textContent = toYMD(end);
						row.insertCell(5).textContent = 'Yes';

						addCard.style.display = 'none';
						addForm.reset();
				});

				// show current date/time in header-right
				document.getElementById('currentDateTime').textContent = new Date().toLocaleString();
		</script>
	</body>
</html>

